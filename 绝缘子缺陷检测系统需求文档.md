# YOLOv11绝缘子缺陷检测系统需求文档

## 1. 项目概述

### 1.1 项目背景
电力系统中绝缘子的安全运行对电网可靠性至关重要。传统人工巡检方式效率低、成本高、安全性差，且容易受到人为因素影响。基于AI视觉技术的绝缘子缺陷检测系统能够自动识别绝缘子缺陷，提高检测效率和准确性。

### 1.2 项目目标
开发一套基于YOLOv11的绝缘子缺陷检测系统，实现对绝缘子各类缺陷的自动识别和分析，支持图片、视频和摄像头实时检测，为电力设备维护提供智能化解决方案。

### 1.3 项目范围
- 绝缘子缺陷检测（瓷质、玻璃、复合绝缘子的污秽、锈蚀、破损等缺陷）
- 多模态检测（图片、视频、摄像头实时检测）
- 检测结果管理和历史记录查询
- 用户认证和权限管理

## 2. 功能需求

### 2.1 用户管理模块
| 功能点 | 描述 | 优先级 |
|-------|------|-------|
| 用户注册 | 支持新用户注册，创建账号密码 | 中 |
| 用户登录 | 支持用户登录，验证身份 | 高 |
| 用户认证 | 确保API访问安全性 | 高 |

### 2.2 检测管理模块
| 功能点 | 描述 | 优先级 |
|-------|------|-------|
| 图片检测 | 支持上传图片进行绝缘子缺陷检测 | 高 |
| 视频检测 | 支持上传视频进行绝缘子缺陷检测 | 高 |
| 摄像头检测 | 支持通过摄像头实时进行绝缘子缺陷检测 | 中 |
| 模型选择 | 支持选择不同的YOLO模型进行检测 | 中 |
| 检测参数调整 | 支持调整置信度阈值、IoU阈值等检测参数 | 中 |

### 2.3 结果管理模块
| 功能点 | 描述 | 优先级 |
|-------|------|-------|
| 检测结果展示 | 实时展示检测结果，包括缺陷类型、位置、置信度等 | 高 |
| 历史记录查询 | 支持查询历史检测记录 | 高 |
| 结果导出 | 支持导出检测结果为PDF、Excel等格式 | 中 |
| 数据可视化 | 支持检测结果的统计分析和可视化展示 | 中 |

### 2.4 系统管理模块
| 功能点 | 描述 | 优先级 |
|-------|------|-------|
| 设备管理 | 自动检测和选择最佳运行设备（GPU/CPU） | 高 |
| 系统监控 | 监控系统内存使用、检测性能等 | 中 |
| 日志管理 | 记录系统运行日志和错误信息 | 中 |

## 3. 非功能需求

### 3.1 性能需求
| 需求点 | 描述 | 指标 |
|-------|------|------|
| 检测速度 | 图片检测响应时间 | < 3秒/张（常规分辨率） |
| 视频处理速度 | 视频检测处理速度 | 至少10帧/秒 |
| 系统响应时间 | API响应时间 | < 500ms（非检测操作） |
| 并发处理能力 | 支持同时处理的请求数 | 至少5个并发请求 |

### 3.2 可靠性需求
| 需求点 | 描述 | 指标 |
|-------|------|------|
| 系统可用性 | 系统正常运行时间 | ≥ 99.5% |
| 错误处理 | 系统异常处理能力 | 自动捕获和记录错误，不影响系统运行 |
| 设备容错 | 设备故障时的处理能力 | GPU故障时自动切换到CPU模式 |

### 3.3 安全性需求
| 需求点 | 描述 | 指标 |
|-------|------|------|
| 用户认证 | 用户身份验证 | 密码验证，API访问控制 |
| 数据安全 | 检测数据的安全性 | 敏感数据加密存储 |
| 网络安全 | 网络传输安全 | 支持HTTPS传输 |

### 3.4 可扩展性需求
| 需求点 | 描述 | 指标 |
|-------|------|------|
| 模型扩展 | 支持添加新的检测模型 | 模块化设计，易于添加新模型 |
| 功能扩展 | 支持添加新的检测类型和功能 | 架构设计支持功能扩展 |
| 性能扩展 | 支持系统性能横向扩展 | 支持多实例部署 |

## 4. 技术架构

### 4.1 架构概述
采用前后端分离架构，前端使用Vue 3 + TypeScript构建单页应用，后端使用Flask提供RESTful API服务，YOLOv11模型负责核心检测功能。

### 4.2 技术栈选择
| 分类 | 技术 | 版本 | 选型理由 |
|-----|------|------|---------|
| 前端框架 | Vue.js | 3.5.26 | 轻量高效，组件化开发，生态成熟 |
| 前端语言 | TypeScript | 5.9.3 | 类型安全，提高代码质量和可维护性 |
| 前端UI库 | Element Plus | 2.13.0 | 企业级UI组件库，功能丰富，文档完善 |
| 前端构建工具 | Vite | 7.3.0 | 快速的开发体验和构建性能 |
| 后端框架 | Flask | 最新版 | 轻量灵活，适合构建RESTful API |
| AI模型 | YOLOv11 | 最新版 | 先进的目标检测算法，精度高，速度快 |
| 深度学习框架 | PyTorch | 最新版 | 灵活强大的深度学习框架，支持GPU加速 |
| 数据库 | MySQL | 8.0+ | 稳定可靠的关系型数据库，适合存储结构化数据 |
| 图像处理 | OpenCV | 最新版 | 强大的图像处理库，支持多种图像处理操作 |

### 4.3 系统架构图
```
┌─────────────────────────────────────────────────────────────┐
│                           前端层                            │
├─────────────────────────────────────────────────────────────┤
│  Vue 3 + TypeScript + Element Plus + Vue Router + Pinia     │
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌───────┐
│  │ 登录注册页  │  │ 检测页面    │  │ 历史记录页  │  │ 系统设置│
│  └─────────────┘  └─────────────┘  └─────────────┘  └───────┘
└────────────────────────┬────────────────────────────────────┘
                         │
┌────────────────────────▼────────────────────────────────────┐
│                           API层                             │
├─────────────────────────────────────────────────────────────┤
│  Flask + Flask-CORS + RESTful API                           │
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌───────┐
│  │ 用户API     │  │ 检测API     │  │ 结果API     │  │ 系统API│
│  └─────────────┘  └─────────────┘  └─────────────┘  └───────┘
└────────────────────────┬────────────────────────────────────┘
                         │
┌────────────────────────▼────────────────────────────────────┐
│                          核心层                             │
├─────────────────────────────────────────────────────────────┤
│  YOLOv11 + PyTorch + OpenCV + 设备管理                      │
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌───────┐
│  │ 模型加载    │  │ 检测引擎    │  │ 设备管理    │  │ 视频处理│
│  └─────────────┘  └─────────────┘  └─────────────┘  └───────┘
└────────────────────────┬────────────────────────────────────┘
                         │
┌────────────────────────▼────────────────────────────────────┐
│                          数据层                             │
├─────────────────────────────────────────────────────────────┤
│  MySQL + 文件系统                                           │
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌───────┐
│  │ 用户数据    │  │ 检测记录    │  │ 上传文件    │  │ 结果文件│
│  └─────────────┘  └─────────────┘  └─────────────┘  └───────┘
└─────────────────────────────────────────────────────────────┘
```

## 5. 前端详细设计

### 5.1 页面结构
| 页面 | 路径 | 组件 | 功能描述 |
|------|------|------|---------|
| 登录页 | /login | Login.vue | 用户登录认证 |
| 注册页 | /register | Register.vue | 新用户注册 |
| 检测页 | /detect | Detect.vue | 图片、视频、摄像头检测界面 |
| 历史记录页 | /history | History.vue | 检测历史记录查询和管理 |
| 系统设置页 | /settings | Settings.vue | 系统参数设置和设备管理 |

### 5.2 核心组件
| 组件 | 描述 | 位置 |
|------|------|------|
| UploadComponent | 文件上传组件，支持图片和视频上传 | src/components/UploadComponent.vue |
| DetectResult | 检测结果展示组件，显示检测结果和统计信息 | src/components/DetectResult.vue |
| ModelSelector | 模型选择组件，支持选择不同的YOLO模型 | src/components/ModelSelector.vue |
| CameraViewer | 摄像头实时检测组件 | src/components/CameraViewer.vue |
| HistoryTable | 历史记录表格组件，支持分页和筛选 | src/components/HistoryTable.vue |

### 5.3 前端API调用
| API路径 | 方法 | 功能描述 | 前端调用位置 |
|---------|------|----------|-------------|
| /api/register | POST | 用户注册 | src/api/auth.ts |
| /api/login | POST | 用户登录 | src/api/auth.ts |
| /api/models | GET | 获取可用模型列表 | src/api/detect.ts |
| /api/detect | POST | 图片检测 | src/api/detect.ts |
| /api/detect_video | POST | 视频检测 | src/api/detect.ts |
| /api/device_info | GET | 获取设备信息 | src/api/system.ts |
| /api/history | GET | 获取检测历史记录 | src/api/history.ts |

### 5.4 前端状态管理
使用Pinia进行状态管理，主要存储以下状态：
- 用户登录状态和信息
- 当前选择的模型和检测参数
- 检测结果和历史记录
- 系统设备信息

## 6. 后端详细设计

### 6.1 核心模块
| 模块 | 描述 | 文件位置 | 功能职责 |
|------|------|----------|---------|
| 应用配置 | Flask应用初始化和配置 | backend/app.py | 应用初始化、CORS配置、数据库连接等 |
| 模型管理 | YOLO模型加载和管理 | backend/app.py | 模型加载、设备选择、模型切换等 |
| 检测引擎 | 核心检测逻辑 | backend/app.py | 图片、视频、摄像头检测 |
| API路由 | RESTful API定义 | backend/app.py | 处理前端请求，返回检测结果 |
| 数据库操作 | 数据库连接和操作 | backend/app.py | 用户管理、检测记录存储和查询 |
| 设备管理 | 硬件设备检测和管理 | backend/app.py | GPU/CPU检测和切换 |
| 日志系统 | 系统日志记录 | backend/app.py | 记录系统运行状态和错误信息 |

### 6.2 API接口设计
| API路径 | 方法 | 模块 | 功能描述 | 请求参数 | 成功响应 |
|---------|------|------|----------|---------|---------|
| /api/register | POST | 用户管理 | 用户注册 | username, password | `{"success": true, "message": "注册成功"}` |
| /api/login | POST | 用户管理 | 用户登录 | username, password | `{"success": true, "message": "登录成功"}` |
| /api/models | GET | 模型管理 | 获取模型列表 | 无 | 模型文件名数组 |
| /api/detect | POST | 检测引擎 | 图片检测 | image文件, model, conf, iou | 检测结果对象 |
| /api/detect_video | POST | 检测引擎 | 视频检测 | video文件, model, conf, iou | 检测结果对象 |
| /api/device_info | GET | 设备管理 | 获取设备信息 | 无 | 设备信息对象 |
| /api/history | GET | 结果管理 | 获取历史记录 | page, limit, filters | 历史记录列表 |
| /api/history/:id | GET | 结果管理 | 获取单条记录 | id | 记录详情 |
| /api/history/:id | DELETE | 结果管理 | 删除记录 | id | `{"success": true}` |

### 6.3 检测流程
1. **图片检测流程**：
   - 接收图片文件和检测参数
   - 加载指定的YOLO模型
   - 进行图片预处理
   - 使用模型进行检测
   - 处理检测结果，绘制边界框
   - 保存结果图片和检测记录
   - 返回检测结果

2. **视频检测流程**：
   - 接收视频文件和检测参数
   - 加载指定的YOLO模型
   - 逐帧读取视频
   - 对关键帧进行检测
   - 处理检测结果，绘制边界框
   - 保存处理后的视频和检测记录
   - 返回检测结果

3. **摄像头检测流程**：
   - 启动摄像头
   - 加载指定的YOLO模型
   - 实时获取摄像头画面
   - 进行实时检测
   - 处理检测结果，绘制边界框
   - 通过流传输返回处理后的画面

## 7. 数据库设计

### 7.1 数据库表结构

#### **users表**
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| id | INT | PRIMARY KEY AUTO_INCREMENT | 用户ID |
| username | VARCHAR(50) | NOT NULL UNIQUE | 用户名 |
| password | VARCHAR(255) | NOT NULL | 密码 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

#### **detection_records表**
| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| id | INT | PRIMARY KEY AUTO_INCREMENT | 记录ID |
| filename | VARCHAR(255) | NOT NULL | 原始文件名 |
| result_filename | VARCHAR(255) | | 结果文件名 |
| video_path | VARCHAR(255) | | 视频文件路径 |
| processed_video_path | VARCHAR(255) | | 处理后视频路径 |
| detect_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 检测时间 |
| model_used | VARCHAR(100) | | 使用的模型 |
| confidence_avg | DECIMAL(5,4) | | 平均置信度 |
| total_objects | INT | | 检测到的目标数量 |
| confidence_threshold | FLOAT | DEFAULT 0.25 | 置信度阈值 |
| iou_threshold | FLOAT | DEFAULT 0.45 | IoU阈值 |
| detections | JSON | | 检测结果详情 |
| detection_type | ENUM('image', 'video', 'camera') | DEFAULT 'image' | 检测类型 |
| duration | FLOAT | | 处理时长（秒） |
| frame_count | INT | | 视频帧数 |
| fps | FLOAT | | 视频帧率 |
| user_id | INT | FOREIGN KEY REFERENCES users(id) | 操作用户ID |

### 7.2 数据库索引
- **users表**：username字段添加唯一索引
- **detection_records表**：detect_time字段添加普通索引，user_id字段添加普通索引

### 7.3 数据库连接配置
```python
DB_CONFIG = {
    'host': 'localhost',
    'user': 'root',
    'password': '123456',
    'database': 'insulator_detection'
}
```

## 8. 部署计划

### 8.1 环境要求
| 环境 | 要求 |
|------|------|
| 操作系统 | Linux/Unix或Windows |
| Python | 3.8+ |
| Node.js | ^20.19.0 || >=22.12.0 |
| MySQL | 8.0+ |
| GPU（可选） | NVIDIA GPU，支持CUDA 11.0+ |

### 8.2 依赖安装
#### 后端依赖
```bash
# 安装Python依赖
pip install flask flask-cors pymysql torch torchvision opencv-python ultralytics numpy psutil
```

#### 前端依赖
```bash
# 安装Node.js依赖
npm install
```

### 8.3 部署步骤
1. **环境准备**：
   - 安装Python、Node.js、MySQL
   - 配置GPU环境（如果使用GPU）

2. **数据库配置**：
   - 创建数据库和表结构
   - 配置数据库连接参数

3. **模型部署**：
   - 将YOLO模型文件放入models目录

4. **后端部署**：
   - 配置环境变量
   - 启动Flask应用

5. **前端部署**：
   - 构建前端项目
   - 部署到静态文件服务器

6. **系统测试**：
   - 功能测试
   - 性能测试
   - 稳定性测试

### 8.4 部署架构
- **开发环境**：本地开发，前后端分离运行
- **测试环境**：独立测试服务器，模拟生产环境
- **生产环境**：
  - 前端：Nginx静态文件服务器
  - 后端：Gunicorn + Flask应用服务器
  - 数据库：独立MySQL服务器
  - 存储：对象存储服务（可选）

## 9. 测试计划

### 9.1 测试策略
- **单元测试**：测试各个模块的独立功能
- **集成测试**：测试模块间的交互和协作
- **端到端测试**：测试完整的用户流程
- **性能测试**：测试系统在不同负载下的性能
- **安全测试**：测试系统的安全性和可靠性

### 9.2 测试重点
| 测试项 | 测试内容 | 测试方法 |
|-------|---------|---------|
| 用户认证 | 登录、注册功能 | 功能测试 |
| 图片检测 | 不同类型绝缘子缺陷检测 | 功能测试 + 精度测试 |
| 视频检测 | 视频文件处理和检测 | 功能测试 + 性能测试 |
| 摄像头检测 | 实时检测功能 | 功能测试 + 性能测试 |
| 模型切换 | 不同模型的加载和切换 | 功能测试 |
| 设备切换 | GPU/CPU自动切换 | 功能测试 + 性能测试 |
| 结果管理 | 历史记录查询和管理 | 功能测试 |
| 系统稳定性 | 长时间运行稳定性 | 稳定性测试 |
| 系统安全性 | API访问控制、数据安全 | 安全测试 |

### 9.3 测试工具
- **前端测试**：Vitest（单元测试）、Playwright（端到端测试）
- **后端测试**：pytest（单元测试）
- **性能测试**：JMeter、Locust
- **安全测试**：OWASP ZAP

## 10. 项目计划

### 10.1 开发阶段
1. **需求分析和设计**：1周
2. **前端开发**：3周
3. **后端开发**：3周
4. **模型集成**：2周
5. **系统测试**：2周
6. **部署和优化**：1周

### 10.2 关键里程碑
- 前端框架搭建完成
- 后端API开发完成
- 模型集成和测试完成
- 系统功能测试通过
- 系统部署上线

### 10.3 风险评估
| 风险 | 影响 | 应对措施 |
|-----|------|---------|
| 模型精度不足 | 检测准确性下降 | 优化模型训练，增加样本数据 |
| 硬件性能不足 | 检测速度慢 | 设备自适应切换，优化算法 |
| 系统稳定性差 | 系统崩溃或异常 | 完善错误处理，增加监控和日志 |
| 数据安全问题 | 用户数据泄露 | 加强数据加密，完善访问控制 |

## 11. 结论

本需求文档基于YOLOv11绝缘子缺陷检测系统的实际代码分析，详细描述了系统的功能需求、技术架构、前后端设计、数据库设计、部署计划和测试计划。系统采用现代化的技术栈，具备良好的性能、可靠性和可扩展性，能够满足电力系统绝缘子缺陷检测的实际需求。

通过本系统的实施，将显著提高绝缘子缺陷检测的效率和准确性，降低人工巡检成本，提高电网运行可靠性，为电力设备维护提供智能化解决方案。